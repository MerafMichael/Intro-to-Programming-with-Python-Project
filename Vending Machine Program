import datetime
import random
import time

RED = "\033[91m"
GREEN = "\033[92m"
YELLOW = "\033[93m"
BLUE = "\033[94m"
MAGENTA = "\033[95m"
CYAN = "\033[96m"
RESET = "\033[0m"  
BOLD = "\033[1m"    

BG_RED = "\033[41m"
BG_GREEN = "\033[42m"
BG_YELLOW = "\033[43m"
BG_BLUE = "\033[44m"
BG_MAGENTA = "\033[45m"
BG_CYAN = "\033[46m"
BG_WHITE = "\033[47m"


def loading_animation(duration=1.5):
    """Displays a simple loading animation with colors."""
    print(CYAN + "Processing" + RESET, end="")
    for _ in range(int(duration / 0.3)):
        for dot in range(1, 4):
            print(YELLOW + "." * dot + RESET, end="\r")
            time.sleep(0.3)
            print(" " * 15, end="\r")
    print(GREEN + "Done!" + RESET)


menu = {
    1: ["üçü Chips", 10],
    2: ["ü•§ Soda", 25],
    3: ["üç´ Chocolate Bar", 15],
    4: ["üíß Water Bottle", 12.20],
    5: ["üç™ Cookies", 13.07],
    6: ["üßÉ Juice Box", 12.50],
    7: ["üç≠ Candy",2.30],
    8: ["üç¨ Gum", 1]
}


while True:  
    selected_items = {} 

    print(GREEN + BOLD + "‚ú®=== Welcome to the Arat Kilo Vending Machine ===‚ú®" + RESET)
    print(BG_BLUE + BOLD + "üìã Here's our menu    price" + RESET)

    for number, (item, price) in menu.items():
        print(BG_YELLOW + BOLD + f"{number}. {item:<15}" + RESET + " - " +
              BG_YELLOW + BOLD + f"${price:.2f}" + RESET)


    while True:
        choice = input(GREEN + BOLD +
                       "\nEnter item number (or 'edit' to modify cart, 'done' to finish): "
                       + RESET).strip().lower()

        if choice == "done":
            if not selected_items:
                loading_animation(0.5)
                print(RED + BOLD +
                      "‚ö†Ô∏è Your cart is empty. Please add at least one item before finishing.")
                continue
            break

        if choice == "edit":
         
            continue

        if not choice.isdigit() or int(choice) not in menu:
            print(RED + BOLD + "‚ùåInvalid input! Please enter a valid input.")
            continue

        choice = int(choice)
        while True:
            quantity = input(GREEN + BOLD +
                             f"How many {menu[choice][0]} would you like? " + RESET).strip()
            if not quantity.isdigit() or int(quantity) <= 0:
                print(RED + BOLD + "‚ùåInvalid quantity please enter a vaild !.")
                continue
            quantity = int(quantity)
            break

        selected_items[choice] = selected_items.get(choice, 0) + quantity
        print(GREEN + BOLD + f"üõíAdded {quantity} x {menu[choice][0]} to your cart.")

    now = datetime.datetime.now()
    date_time = now.strftime("%Y-%m-%d %H:%M:%S")

    transaction_counter = 1
    today = now.strftime("%Y%m%d")
    transaction_number = f"TR-{today}-{transaction_counter:03d}"

      
    loading_animation(0.3)
    print(BG_WHITE+ YELLOW + BOLD + "\nüßæ ======================= Receipt =======================üßæ")
    print(BG_WHITE+ CYAN + f"{'ABCD PLC':<60}")
    print(BG_WHITE+ CYAN + "Vending Machine 001  Location: Arat Killo Plaza")
    print(BG_WHITE+ CYAN + f"Date & Time: {date_time}")
    print(BG_WHITE+ CYAN + f"Transaction #: {transaction_number}")
    print(BG_WHITE+ CYAN + "-------------------------------------------------")
    print(BG_WHITE+ CYAN + BOLD + f"{'Item':<15}{'Qty':<10}{'Price':<10}{'Line Total'}")
    print(BG_WHITE+ CYAN + "-------------------------------------------------" + RESET)

    total = 0
    for number, quantity in selected_items.items():
     item, price = menu[number]
     line_total = price * quantity
    print(BG_WHITE + CYAN + f"{item:<15}{quantity:<10}${price:<9.2f}${line_total:.2f}" + RESET)
    total += line_total

    print(BG_WHITE+ CYAN+ "-------------------------------------------------" + RESET)
    print(BG_WHITE+ CYAN + BOLD + f"{'TOTAL':<15}{'':<10}{'':<10}${total:.2f}" + RESET)
    print(BG_WHITE+ CYAN+ "=================================================" + RESET)

    while True:
        try:
            payment = float(input(GREEN + BOLD +
                                  f"Please insert payment (Total:${total:.2f}): " + RESET))
            if payment < total:
                print(RED + f"‚ö†Ô∏èInsufficient payment! You still owe ${total - payment:.2f}." + RESET)
            else:
                loading_animation(0.5)
                change = payment - total
                print(GREEN + BOLD +
                      f"‚úÖPayment accepted! Your change is ${change:.2f}" + RESET)
                break
        except ValueError:
            print(RED + "‚ùåInvalid input! Please enter a valid amount." + RESET)


    print(BG_YELLOW + BOLD +
          "üéâüéâThank you for shopping at Arat Kilo Vending Machine!üéâüéâ" + RESET)

    again = input(GREEN + "\nWould you like to make another purchase? (yes/no): " +
                  RESET).strip().lower()
    if again != "yes":
        print(BG_YELLOW + CYAN + BOLD +
              "üëã Thank you for using Arat Kilo Vending Machine! Goodbye!" + RESET)
        break
